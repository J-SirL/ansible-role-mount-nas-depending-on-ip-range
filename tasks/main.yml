# tasks/main.yml

- name: Remove existing NAS mount script
  ansible.builtin.file:
    path: "{{ script_path }}"
    state: absent

- name: Remove existing systemd service file
  ansible.builtin.file:
    path: "/etc/systemd/system/{{ service_name }}.service"
    state: absent

- name: Remove existing NetworkManager dispatcher script
  ansible.builtin.file:
    path: "{{ network_dispatcher_script }}"
    state: absent

- name: Reload systemd to apply changes
  ansible.builtin.systemd:
    daemon_reload: yes

- name: Disable existing NAS mount service
  ansible.builtin.systemd:
    name: "{{ service_name }}"
    enabled: no
    state: stopped

# Following tasks to upload new scripts and configurations

- name: Upload NAS mount script
  ansible.builtin.template:
    src: mount_nas_check_type.sh.j2
    dest: "{{ script_path }}"
    mode: '0755'

- name: Create a systemd service file for the script
  ansible.builtin.template:
    src: nas_mount_service.j2
    dest: "/etc/systemd/system/{{ service_name }}.service"
    mode: '0644'
  notify:
    - Reload systemd
    - Start nas_mount service

- name: Create NetworkManager dispatcher script to trigger the service
  ansible.builtin.template:
    src: network_dispatcher_script.j2
    dest: "{{ network_dispatcher_script }}"
    mode: '0755'
  notify:
    - Reload NetworkManager
